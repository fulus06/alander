# Alander 详细开发计划

## 概述

本文档是基于原始开发计划的进一步细化和具体实施步骤，旨在为开发团队提供清晰的实施路线图。计划将采用敏捷开发方法，每个阶段都有明确的交付物和验收标准。

---

## 第一阶段：基石构建 (Foundation & Core)
**总时长**：8-10周  
**目标**：构建一个能跑在桌面和浏览器上的高性能 3D 查看器

### 周 1-2：项目初始化
#### 交付物：基础窗口应用
- [ ] 创建 Rust 工作区，设置工作空间结构
  ```toml
  # Cargo.toml 示例结构
  [workspace]
  members = [
    "alander_core",
    "alander_render", 
    "alander_editor",
    "alander_wasm"
  ]
  ```
- [ ] 实现 `winit` 窗口创建与管理
- [ ] 集成 `wgpu` 渲染后端，支持多平台
- [ ] 设置 `log`/`tracing` 日志系统，支持不同日志级别
- [ ] **验收标准**：黑色窗口，ESC 键退出，日志正常输出

### 周 3：ECS 架构基础
#### 交付物：场景数据结构
- [ ] 引入 `bevy_ecs` 或 `hecs` 作为 ECS 框架
- [ ] 定义核心组件：
  ```rust
  pub struct Transform {
      pub position: Vec3,
      pub rotation: Quat,
      pub scale: Vec3,
  }
  
  pub struct Mesh {
      pub handle: Handle<MeshData>,
  }
  
  pub struct Material {
      pub handle: Handle<MaterialData>,
  }
  
  pub struct Name(pub String);
  ```
- [ ] 实现基础的资源管理系统
- [ ] **验收标准**：创建实体并打印其 ID，资源正确加载

### 周 4-6：渲染管线
#### 交付物：基础渲染系统
- [ ] 编写 WGSL 基础着色器（顶点 + 片元）
- [ ] 实现 Camera 系统（透视投影和视图矩阵）
- [ ] 实现简单网格渲染（三角形、立方体）
- [ ] 实现 Orbit Controller（鼠标控制）
- [ ] 添加基础光照模型（Phong 或 PBR）
- [ ] **验收标准**：3D 物体显示，可 360° 旋转观察

### 周 7-8：资产导入
#### 交付物：资产加载系统
- [ ]集成 `gltf` crate 实现 `.gltf`/`.glb` 加载
- [ ] 实现材质解析和纹理加载
- [ ] 添加错误处理和进度指示
- [ ] 测试加载标准模型（如 Sponza 场景）
- [ ] **验收标准**：成功加载并显示复杂 glTF 模型

---

## 第二阶段：交互与编辑器框架 (Interaction & Editor)
**总时长**：10-12周  
**目标**：从"查看器"转变为"编辑器"

### 周 9-10：UI 框架集成
#### 交付物：基础编辑器界面
- [ ] 集成 `egui` 和 `egui_dock`
- [ ] 实现可拖拽的面板布局
- [ ] 创建基础面板：
  - 视口面板 (Viewport)
  - 大纲视图 (Outliner)
  - 属性面板 (Properties)
- [ ] 实现主题系统
- [ ] **验收标准**：功能性的编辑器界面，面板可交互

### 周 11-12：场景交互
#### 交付物：基础拾取系统
- [ ] 实现射线检测 (Ray Casting)
- [ ] 添加基础拾取功能
- [ ] 实现选中高亮效果
- [ ] **验收标准**：点击物体可选中并高亮显示

### 周 13-14：3D 操作工具
#### 交付物：Gizmo 系统
- [ ] 集成 `transform-gizmo` 或自实现
- [ ] 实现三轴移动、旋转和缩放工具
- [ ] 添加坐标变换的精确输入
- [ ] 实现本地/全局坐标系统切换
- [ ] **验收标准**：可以精确操作 3D 物体

### 周 15-16：撤销/重做系统
#### 交付物：命令系统
- [ ] 实现命令模式 (Command Pattern)
- [ ] 为常见操作实现撤销/重做功能
- [ ] 添加快捷键绑定 (Ctrl+Z/Ctrl+Y)
- [ ] 实现命令历史面板
- [ ] **验收标准**：大部分操作可撤销/重做

### 周 17-18：属性编辑
#### 交付物：完整属性系统
- [ ] 完善属性面板，显示所有可编辑属性
- [ ] 实现数值、颜色、向量等不同类型属性的编辑器
- [ ] 添加材质属性编辑
- [ ] 实现实时预览功能
- [ ] **验收标准**：可通过属性面板修改物体所有属性

### 周 19-20：场景管理
#### 交付物：场景系统
- [ ] 实现场景保存/加载使用简化格式 (如 JSON 或 RON)
- [ ] 添加场景组织功能（分组、父子关系）
- [ ] 实现实例化渲染系统
- [ ] **验收标准**：可保存和加载复杂场景

---

## 第三阶段：节点系统与程序化生成 (The "Alander" Magic)
**总时长**：14-16周  
**目标**：实现差异化，对标 Houdini/Blender Geometry Nodes

### 周 21-23：节点图编辑器
#### 交付物：基础节点编辑器
- [ ] 集成 `egui_node_graph`
- [ ] 实现基础节点类型：
  - 输入节点 (Input)
  - 输出节点 (Output)
  - 数学节点 (Math)
  - 常量节点 (Constant)
- [ ] 实现节点连线和数据可视化
- [ ] 添加节点搜索和分类
- [ ] **验收标准**：可创建和连接基础节点

### 周 24-26：数据流核心
#### 交付物：数据流引擎
- [ ] 实现节点执行引擎
- [ ] 定义数据流协议和类型系统
- [ ] 实现基本几何体生成节点
- [ ] 添加变换节点（位移、旋转、缩放）
- [ ] 实现修改器节点（如阵列、镜像）
- [ ] **验收标准**：节点图控制场景中的物体

### 周 27-29：程序化建模
#### 交付物：几何节点系统
- [ ] 实现程序化建模节点：
  - 基础几何体生成
  - 布尔运算
  - 细分和优化
  - 噪声和变形
- [ ] 添加参数化曲线处理
- [ ] 实现基于距离场的建模支持
- [ ] **验收标准**：可通过节点创建复杂模型

### 周 30-32：材质节点
#### 交付物：着色器图系统
- [ ] 实现材质编辑节点
- [ ] 将节点图编译为 WGSL 代码
- [ ] 添加 PBR 材质支持
- [ ] 实现纹理节点和 UV 处理
- [ ] **验收标准**：实时编辑和预览材质

### 周 33-36：节点优化与扩展
#### 交付物：完善节点系统
- [ ] 实现节点执行缓存和优化
- [ ] 添加自定义节点创建系统
- [ ] 实现节点库和预设系统
- [ ] 性能优化和分析
- [ ] **验收标准**：节点系统稳定且高效

---

## 第四阶段：动画与物理 (Animation & Physics)
**总时长**：12-14周  
**目标**：让场景动起来

### 周 37-39：时间轴系统
#### 交付物：时间控制核心
- [ ] 实现时间轴界面
- [ ] 创建时间控制 API
- [ ] 实现播放控制（播放/暂停/停止）
- [ ] 添加帧率和时间码支持
- [ ] **验收标准**：基础的时间控制功能

### 周 40-42：关键帧动画
#### 交付物：动画系统
- [ ] 实现 Keyframe 数据结构
- [ ] 添加基本插值算法（Lerp, Slerp）
- [ ] 实现曲线编辑器界面
- [ ] 添加自动插值选项
- [ ] **验收标准**：可以创建和编辑简单动画

### 周 43-45：物理集成
#### 交付物：物理引擎集成
- [ ] 集成 `rapier3d` 物理引擎
- [ ] 实现刚体组件
- [ ] 添加物理材质和碰撞形状
- [ ] 实现物理到动画的桥接
- [ ] **验收标准**：物体可以受物理影响运动

### 周 46-48：约束与角色动画
#### 交付物：高级动画功能
- [ ] 实现骨骼系统
- [ ] 添加 IK/FK 混合
- [ ] 实现蒙皮和权重绘制
- [ ] 添加动画分层和混合
- [ ] **验收标准**：可以创建和控制复杂的角色动画

### 周 49-50：动画导出与导入
#### 交付物：动画资源系统
- [ ] 实现动画导出到 glTF
- [ ] 添加常见动画格式支持
- [ ] 实现动画烘焙功能
- [ ] 添加动画压缩和优化
- [ ] **验收标准**：动画可以导入导出

---

## 第五阶段：Web 协作与云端化 (The Killer Feature)
**总时长**：12-14周  
**目标**：实现"多人实时协作"

### 周 51-53：WebAssembly 移植
#### 交付物：Web 版本
- [ ] 设置 `wasm-bindgen` 和 `wasm-pack`
- [ ] 解决平台特定代码的兼容性
- [ ] 实现浏览器特定的 API 接口
- [ ] 优化 Wasm 包大小和加载时间
- [ ] **验收标准**：浏览器中运行的基础版本

### 周 54-56：网络同步架构
#### 交付物：实时同步系统
- [ ] 集成 `matchbox_socket` (WebRTC P2P)
- [ ] 实现 CRDT 数据同步
- [ ] 设计网络消息协议
- [ ] 实现状态同步和冲突解决
- [ ] **验收标准**：多客户端基础同步

### 周 57-59：协作 UI 与工具
#### 交付物：协作功能实现
- [ ] 实现用户标识和在线状态
- [ ] 添加实时协作光标和选择高亮
- [ ] 实现操作冲突解决 UI
- [ ] 添加协作历史回放
- [ ] **验收标准**：完整的协作体验

### 周 60-62：性能优化与部署
#### 交付物：生产就绪系统
- [ ] 网络传输优化
- [ ] 服务器部署架构设计
- [ ] 用户认证和权限系统
- [ ] 实现版本同步和分支
- [ ] **验收标准**：可部署的协作平台

### 周 63-64：文档与发布准备
#### 交付物：发布版本
- [ ] 完善用户文档和教程
- [ ] 性能测试和优化
- [ ] 自动化测试和 CI/CD
- [ ] 打包和分发系统
- [ ] **验收标准**：稳定的发布版本

---

## 持续开发与迭代

### 版本发布计划
- **Alpha 版本**：第2阶段完成后（约6个月）
- **Beta 版本**：第4阶段完成后（约14个月）
- **正式发布**：第5阶段完成后（约17个月）

### 社区与反馈
- 从 Alpha 版本开始收集社区反馈
- 每月发布进度报告和演示视频
- 建立开放的开发问题和功能请求系统

### 扩展路线图（发布后）
- VR/AR 支持
- AI 辅助建模工具
- 插件系统与脚本 API（基于 Rhai）
- 移动设备支持（通过 WebAssembly）